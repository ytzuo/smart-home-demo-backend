# 子模块效果预期

## 通信机制

​		本系统在局域网内使用DDS（数据分发服务）进行设备间通信。DDS采用发布-订阅模式，提供实时、高效、可靠的数据传输，特别适合智能家居场景下的设备互联。设备通过DDS可以发布状态信息、接收控制命令，并实现设备间的自动发现。

## HomeSimulator：

​		有多个模拟不同家具的线程运行，负责维护对应家具的状态，属性等数据。定时向HomeSimulator的主线程发送自己的状态。

​		主线程定时将各个家具线程的状态整理并通过DDS（局域网内）或Cloud转发（局域网外），发送到手机APP。
​		主线程也负责通过DDS或Cloud接收来自手机APP的Command，根据命令内容修改家具的状态，属性等数据。
​		进入局域网时通过DDS广播Presence消息，实现设备自动发现。

​		有一个供演示使用的线程，负责接收输入，进行家具状态的修改、引发报警状态（本质也是修改家具维护的状态）

## CarSimulator：

​		CarSimulator主线程负责维护状态，属性等数据，以及定时通过DDS（局域网内）或Cloud转发（局域网外），发送到手机APP。
​		同时也负责接收来自手机APP的Command，根据命令内容修改自己维护的状态，属性等数据。
​		进入局域网时通过DDS广播Presence消息，实现设备自动发现。

​		有一个供演示使用的线程，负责接收输入，进行汽车状态的修改、引发报警状态。

## CloudRouterSim：

​		接收和维护各个设备的Presence状态，判断设备局域网状态，决定是否要进行消息的转发。
​		若家具/汽车和手机不位于同一局域网，则进行转发（Alert和Command），否则仅持久化。

​		当设备位于同一局域网时，设备间通过DDS直接通信，无需CloudRouter转发，提高通信效率和实时性。
​		CloudRouter主要负责跨局域网的消息转发和状态持久化。
