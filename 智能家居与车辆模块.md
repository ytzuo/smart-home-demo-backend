# æ™ºèƒ½å®¶å±…ä¸æ±½è½¦æ•°æ®åˆ†ææŠ¥å‘ŠåŠŸèƒ½å®ç°æ“ä½œæ‰‹å†Œ

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ç°æœ‰ç³»ç»Ÿä¸­æ·»åŠ **å®¶å±…èƒ½è€—åˆ†æ**å’Œ**è½¦è¾†å¥åº·æŠ¥å‘Š**åŠŸèƒ½ã€‚
 æ•°æ®é€šè¿‡ DDS ä¸»é¢˜ä¼ è¾“ï¼Œå¹¶åœ¨å‰ç«¯æ¨¡æ‹Ÿå™¨ï¼ˆMobileAppSimulatorï¼‰ä¸­å±•ç¤ºã€‚
 æ‰€æœ‰ä¿®æ”¹åŸºäºç°æœ‰æ¶æ„æ‰©å±•ï¼Œä¸å½±å“åŸæœ‰æŠ¥è­¦ã€æ§åˆ¶é€»è¾‘ã€‚

------

## äºŒã€å‰ç½®æ¡ä»¶

- **å¼€å‘ç¯å¢ƒ**ï¼šJDK 8+ã€Mavenã€DDSå¼€å‘ç¯å¢ƒï¼ˆå·²é…ç½® ZRDDS_JAVA åº“ï¼‰
- **ä»£ç åº“æ–‡ä»¶**ï¼š
  - æ™ºèƒ½å®¶å±…åç«¯ï¼š`HomeSimulatorAlert.java`
  - æ™ºèƒ½æ±½è½¦åç«¯ï¼š`CarSimulator.java`
  - å‰ç«¯æ¨¡æ‹Ÿå™¨ï¼š`MobileAppSimulator.java`
  - DDS ç±»å‹å®šä¹‰ç›®å½•ï¼š`src/main/java/IDL/`

------

## ä¸‰ã€åç«¯å¼€å‘ï¼šæ–°å¢æ•°æ®æ¨¡å‹ä¸å‘å¸ƒé€»è¾‘

### 3.1 å®šä¹‰ DDS æ•°æ®ç±»å‹ï¼ˆIDL æ–‡ä»¶ï¼‰

æ–‡ä»¶è·¯å¾„ï¼š`src/main/java/IDL/SmartDemo03.idl`

```
module SmartDemo03 {
    typedef sequence<octet> Blob;
    
    struct Presence {
        boolean inRange;
        string deviceId;
        string deviceType;
        string timeStamp;
    };

    struct VehicleStatus {
        boolean engineOn;
        boolean doorsLocked;
        boolean acOn;
        float fuelPercent;
        string location;
        string timeStamp;
    };

    struct HomeStatus {
        sequence<string> deviceIds;
        sequence<string> deviceTypes;
        sequence<string> deviceStatus; //é‡‡ç”¨JSONæ ¼å¼, åç«¯å°†æ¯ä¸ªå®¶å…·çš„çŠ¶æ€åˆ†åˆ«ç»„æˆJSONæ ¼å¼, å‰ç«¯æŒ‰JSONæ ¼å¼è¿›è¡Œè§£æ, ä¿è¯å¯æ‰©å±•æ€§
        string timeStamp;
    };

    struct Alert {
        string deviceId;
        string deviceType;
        long alert_id;
        string level; //INFO, WARN, ALERT
        string description;
        string timeStamp;
    };

    struct AlertMedia { //æŠ¥è­¦æ—¶ä¼ è¾“å›¾åƒ, æš‚æœªå¯ç”¨
        string deviceId;
        string deviceType;
        long alert_id;
        long media_type;
        long total_size;
        long chunk_seq;
        long chunk_size;
        Blob chunk;
    };

    struct Command {
        string deviceId;
        string deviceType;
        string action; //æ§åˆ¶å‘½ä»¤ç±»å‹
        float value; //æ§åˆ¶å‘½ä»¤å€¼
        string timeStamp;
    };
    
    /**
     * å®¶å±…èƒ½è€—æŠ¥å‘Šï¼šç”¨äºä¼ è¾“è®¾å¤‡èƒ½è€—ç»Ÿè®¡æ•°æ®
     */
    struct EnergyReport {
        string deviceId;          // è®¾å¤‡IDï¼ˆå¦‚"light1"ã€"ac1"ï¼‰
        string deviceType;        // è®¾å¤‡ç±»å‹ï¼ˆå¦‚"light"ã€"ac"ï¼‰
        float currentPower;       // å½“å‰åŠŸç‡ï¼ˆå•ä½ï¼šWï¼‰
        float dailyConsumption;   // å½“æ—¥èƒ½è€—ï¼ˆå•ä½ï¼škWhï¼‰
        float weeklyConsumption;  // æœ¬å‘¨èƒ½è€—ï¼ˆå•ä½ï¼škWhï¼‰
        string timeStamp;         // æ•°æ®é‡‡é›†æ—¶é—´æˆ³ï¼ˆæ ¼å¼ï¼šyyyy-MM-dd HH:mm:ssï¼‰
    };

    /**
     * è½¦è¾†å¥åº·æŠ¥å‘Šï¼šç”¨äºä¼ è¾“è½¦è¾†éƒ¨ä»¶çŠ¶æ€åŠç»´æŠ¤ä¿¡æ¯
     */
    struct VehicleHealthReport {
        string vehicleId;                 // è½¦è¾†å”¯ä¸€IDï¼ˆå¦‚"car_001"ï¼‰
        sequence<string> componentTypes;  // éƒ¨ä»¶ç±»å‹åˆ—è¡¨ï¼ˆå¦‚"engine"ã€"tire"ã€"brake"ï¼‰
        sequence<string> componentStatuses; // éƒ¨ä»¶çŠ¶æ€åˆ—è¡¨ï¼ˆ"normal"/"warning"/"error"ï¼‰
        sequence<float> metrics;          // éƒ¨ä»¶æŒ‡æ ‡åˆ—è¡¨ï¼ˆå¦‚æ¸©åº¦ã€èƒå‹ã€å¥åº·åº¦ç­‰æ•°å€¼ï¼‰
        string nextMaintenance;           // ä¸‹æ¬¡ä¿å…»å»ºè®®æ—¥æœŸï¼ˆæ ¼å¼ï¼šyyyy-MM-ddï¼‰
        string timeStamp;                 // æŠ¥å‘Šç”Ÿæˆæ—¶é—´æˆ³ï¼ˆæ ¼å¼ï¼šyyyy-MM-dd HH:mm:ssï¼‰
    };
};
```

------

### 3.2 æ™ºèƒ½å®¶å±…åç«¯ï¼šæ·»åŠ èƒ½è€—æ•°æ®å‘å¸ƒ

#### 3.2.1 åˆ›å»ºèƒ½è€—å‘å¸ƒå™¨ï¼ˆEnergyReportPublisher.javaï¼‰

æ–‡ä»¶è·¯å¾„ï¼š
 `C:/Users/30103/Desktop/summer school/smart-home-demo-backend/HomeSimulator/src/main/java/HomeSimulator/EnergyReportPublisher.java`

ä¸»è¦èŒè´£ï¼š

- å®šæ—¶é‡‡é›†è®¾å¤‡èƒ½è€—æ•°æ®
- å°è£…ä¸º `EnergyReport`
- é€šè¿‡ DDS ä¸»é¢˜å‘å¸ƒ

ï¼ˆå®ç°æ–¹å¼å‚è€ƒ `VehicleHealthPublisher`ï¼Œä¿æŒä¸€è‡´çš„æ¶æ„ï¼‰

#### 3.2.2 ä¿®æ”¹ HomeSimulatorAlert.java é›†æˆå‘å¸ƒå™¨

æ–‡ä»¶è·¯å¾„ï¼š
 `C:/Users/30103/Desktop/summer school/smart-home-demo-backend/HomeSimulator/src/main/java/HomeSimulator/HomeSimulatorAlert.java`

ä¿®æ”¹ç‚¹ï¼š

- **æ–°å¢æˆå‘˜å˜é‡**ï¼š`private EnergyReportPublisher energyReportPublisher;`
- **æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–å‘å¸ƒå™¨**
- **åœ¨ start() æ–¹æ³•ä¸­å¯åŠ¨èƒ½è€—å®šæ—¶ä»»åŠ¡**

------

### 3.3 æ™ºèƒ½æ±½è½¦åç«¯ï¼šæ·»åŠ è½¦è¾†å¥åº·æŠ¥å‘Šå‘å¸ƒ

#### 3.3.1 åˆ›å»ºè½¦è¾†å¥åº·å‘å¸ƒå™¨ï¼ˆVehicleHealthPublisher.javaï¼‰

æ–‡ä»¶è·¯å¾„ï¼š
 `C:/Users/30103/Desktop/summer school/smart-home-demo-backend/CarSimulator/src/main/java/VehicleHealthPublisher.java`

#### 3.3.2 ä¿®æ”¹ CarSimulator.java é›†æˆå‘å¸ƒå™¨

æ–‡ä»¶è·¯å¾„ï¼š
 `C:/Users/30103/Desktop/summer school/smart-home-demo-backend/CarSimulator/src/main/java/CarSimulator.java`

ä¿®æ”¹ç‚¹ï¼š

- **æ–°å¢æˆå‘˜å˜é‡**ï¼š`private VehicleHealthPublisher vehicleHealthPublisher;`
- **æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–å‘å¸ƒå™¨**
- **åœ¨ start() æ–¹æ³•ä¸­å¯åŠ¨è½¦è¾†å¥åº·æ•°æ®é‡‡é›†ä»»åŠ¡**

------

## å››ã€å‰ç«¯å¼€å‘ï¼šæ•°æ®è®¢é˜…ä¸UIå±•ç¤º

### 4.1 å‰ç«¯æ¨¡æ‹Ÿå™¨ï¼ˆMobileAppSimulatorï¼‰ä¿®æ”¹

æ–‡ä»¶è·¯å¾„ï¼š
 `C:/Users/30103/Desktop/summer school/smart-home-demo-backend/AppTest/src/main/java/AppSimulator/MobileAppSimulator.java`

#### 4.1.1 è®¢é˜…æ–° DDS ä¸»é¢˜

- æ³¨å†Œ `EnergyReport` å’Œ `VehicleHealthReport` ç±»å‹
- åˆ›å»ºè®¢é˜…å™¨å¹¶ç¼“å­˜æœ€æ–°æ•°æ®

#### 4.1.2 æ·»åŠ  UI èœå•ä¸æŠ¥å‘Šå±•ç¤º

- **å®¶å±…æ§åˆ¶èœå•**ï¼šæ–°å¢â€œd. æŸ¥çœ‹èƒ½è€—æŠ¥å‘Šâ€é€‰é¡¹
- **è½¦è¾†æ§åˆ¶èœå•**ï¼šæ–°å¢â€œe. æŸ¥çœ‹å¥åº·æŠ¥å‘Šâ€é€‰é¡¹

------

## äº”ã€æµ‹è¯•ä¸éªŒè¯

### 5.1 åç«¯æ•°æ®å‘å¸ƒéªŒè¯

- å¯åŠ¨å®¶å±…åç«¯ï¼Œæ—¥å¿—åº”è¾“å‡ºï¼š

  ```
  [EnergyReportPublisher] å‘å¸ƒèƒ½è€—æŠ¥å‘Š: è®¾å¤‡=ac1, å½“æ—¥èƒ½è€—=3.60kWh
  ```

- å¯åŠ¨è½¦è¾†åç«¯ï¼Œæ—¥å¿—åº”è¾“å‡ºï¼š

  ```
  [VehicleHealthPublisher] å‘å¸ƒè½¦è¾†å¥åº·æŠ¥å‘Š: car_001
  ```

### 5.2 å‰ç«¯æ•°æ®å±•ç¤ºéªŒè¯

è¿›å…¥å‰ç«¯æ¨¡æ‹Ÿå™¨ï¼š

- èœå• â†’ â€œå®¶å±…æ§åˆ¶â€ â†’ â€œd. æŸ¥çœ‹èƒ½è€—æŠ¥å‘Šâ€

  ```
  ğŸ  å®¶å±…èƒ½è€—æŠ¥å‘Š (2024-05-20 15:30:00)
  è®¾å¤‡ID: ac1
  å½“å‰åŠŸç‡: 1500.0W
  å½“æ—¥èƒ½è€—: 3.60kWh
  æœ¬å‘¨èƒ½è€—: 25.20kWh
  ```

- èœå• â†’ â€œè½¦è¾†æ§åˆ¶â€ â†’ â€œe. æŸ¥çœ‹å¥åº·æŠ¥å‘Šâ€

  - å±•ç¤ºå„éƒ¨ä»¶çŠ¶æ€å’ŒæŒ‡æ ‡

------

## å…­ã€å¸¸è§é—®é¢˜ä¸è§£å†³

| é—®é¢˜ç°è±¡           | å¯èƒ½åŸå›            | è§£å†³æ–¹æ³•                                                     |
| ------------------ | ------------------ | ------------------------------------------------------------ |
| å‰ç«¯æ”¶ä¸åˆ°æŠ¥å‘Šæ•°æ® | DDS ä¸»é¢˜åç§°ä¸åŒ¹é… | æ£€æŸ¥åç«¯å‘å¸ƒä¸å‰ç«¯è®¢é˜…çš„ä¸»é¢˜åç§°æ˜¯å¦ä¸€è‡´ï¼ˆå¦‚â€œEnergyReportâ€ï¼‰ |
| æŠ¥å‘Šæ•°æ®å­—æ®µä¸ºç©º   | IDL ç±»å‹æœªæ³¨å†Œ     | ç¡®ä¿ `EnergyReportTypeSupport` å’Œ `VehicleHealthReportTypeSupport` å·²æ³¨å†Œåˆ°å‚ä¸è€… |
| å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œ     | çº¿ç¨‹æ± æœªå¯åŠ¨       | ç¡®è®¤ `scheduleAtFixedRate` å·²è°ƒç”¨                            |

------

## ä¸ƒã€æ€»ç»“

é€šè¿‡æœ¬æ–‡æ¡£æ“ä½œï¼Œç³»ç»Ÿå°†åœ¨ **ä¸ä¿®æ”¹åŸæœ‰æŠ¥è­¦/æ§åˆ¶é€»è¾‘** çš„å‰æä¸‹ï¼Œ
 æ–°å¢ **å®¶å±…èƒ½è€—åˆ†æ** å’Œ **è½¦è¾†å¥åº·æŠ¥å‘Š** åŠŸèƒ½ã€‚
 åç«¯åˆ†åˆ«ç”± `EnergyReportPublisher` å’Œ `VehicleHealthPublisher` è´Ÿè´£æ•°æ®å‘å¸ƒï¼Œ
 å‰ç«¯é€šè¿‡èœå•æŸ¥çœ‹æŠ¥å‘Šï¼Œå®ç°ç±»ä¼¼ä¸»æµ App çš„æ•°æ®åˆ†æå±•ç¤ºæ•ˆæœã€‚